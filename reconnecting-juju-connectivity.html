<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="http://blog.dasroot.net/theme/css/semantic.min.css">
  <link rel="stylesheet" type="text/css" href="http://blog.dasroot.net/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="http://blog.dasroot.net/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Charles Butler">
  <meta name="description" content="Posts and writings by Charles Butler">

  <link href="http://blog.dasroot.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Chuck@Home Atom" />
<meta name="keywords" content="juju, planet">

  <title>
    Chuck@Home
&ndash; Reconnecting Juju Connectivity  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29116636-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://blog.dasroot.net">
        <img src="http://www.gravatar.com/avatar/78270a8df5051560ab56ad16bc4724a3.png?s=200" alt="Chuck@home" class="ui medium circular image">
      </a>
      <h2><a href="http://blog.dasroot.net">Chuck@Home</a></h2>
      <p>juju deploy happiness</p>
      <ul>
        <li><a href="http://charlesbutler.me/" target="_blank">About Chuck</a></li>
        <li><a href="http://blog.juju.solutions/" target="_blank">My GPG Key</a></li>
        <li><a href="http://blog.dasroot.net/archives" target="_blank">Archives</a></li>
        <li><a href="http://github.com/chuckbutler" target="_blank">Github</a></li>
        <li><a href="http://twitter.com/lazypower" target="_blank">Twitter</a></li>
        <li><a href="https://plus.google.com/+CharlesButlertheNinja" target="_blank">Google+</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="http://blog.dasroot.net">Index</a> &brvbar; <a href="http://blog.dasroot.net/archives.html">Archives</a>
      &brvbar; <a href="http://blog.dasroot.net/feeds/all.atom.xml">Atom</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h3><a href="http://blog.dasroot.net/reconnecting-juju-connectivity.html">Reconnecting Juju Connectivity</a></h3>
  </div>
  <div class="article_text">
    <hr />
<p>When disaster strikes, the first instinct is to panic right? You don't need to panic just yet when your IT staff has come to you, the devopsy admin sent from the future with cool tools, and tells you that there is a new networking policy change. And every one of your units are going to under go an IP Refresh, and domain change. </p>
<p>Juju uses flat files to store configuration on your workstation, and the nodes, so all you need to do is do some note taking on what the IP is to your bootstrap node - and juju will take care of the rest for you.</p>
<hr />
<h3>Restoring connectivity to the state server from your client workstation</h3>
<p>You will need to edit the <code>jenv</code> that juju created for the environment during <code>juju bootstrap</code> which will be located: <code>$JUJU_HOME/environments/&lt;environment_name&gt;.jenv</code></p>
<p>The <code>jenv</code> has a yaml file format, so be familiar with that so you know what to look for:</p>
<div class="highlight"><pre><span class="n">state</span><span class="o">-</span><span class="n">servers</span><span class="o">:</span>
<span class="o">-</span> <span class="mf">173.173.4.187</span><span class="o">:</span><span class="mi">17070</span>
<span class="o">-</span> <span class="mf">172.187.3.21</span><span class="o">:</span><span class="mi">17070</span>
</pre></div>


<p>Each line item below <code>state-servers</code> will need to be updated with the new state servers address. You may have one or more listed here depending on if you did <code>juju ensure-availability</code> - which will turn a single node state server into a High Availability state server.</p>
<h3>Restoring connectivity to the state server from juju-agents</h3>
<p>There will be 2 or more configuration files to edit per agent. </p>
<ul>
<li>1 for the machine</li>
<li>1 for each unit-agent of service you deploy to the machine</li>
</ul>
<p>Given the scenario:</p>
<div class="highlight"><pre><span class="n">juju</span> <span class="n">deploy</span> <span class="n">elasticsearch</span>
</pre></div>


<p>You will have 2 files to edit - the Machine conf, and the elasticsearch conf. If you have co-located any services on the machine you will have an additional config per service added to the machine. (Dont forget about KVM and LXC containers, as this also increases the number of conf files to edit, and will reside in that services container)</p>
<p>You will find the Machine configuration in <code>/var/lib/juju/agents/machine-1/agent.conf</code> 
You will find the service configuration in <code>/var/lib/juju/agents/unit-elasticsearch-0/unit.conf</code></p>
<p>then kill jujud and let upstart restart it</p>
<p>This has all been documented on <a href="http://askubuntu.com/questions/540209/ip-domainname-of-juju-master-or-slaves-changes">AskUbuntu</a> with the user that joined #juju on irc.freenode.net - trying to discover how to do this themselves. If you've got the time, give them a quick upvote for a great question/answer</p>
  </div>
  <div class="article_meta">
    <p>Posted on: Fri 07 November 2014</p>
    <p>Category: <a href="http://blog.dasroot.net/category/misc.html">misc</a>
 &ndash; Tags:
      <a href="http://blog.dasroot.net/tag/juju.html">juju</a>,      <a href="http://blog.dasroot.net/tag/planet.html">planet</a>    </p>
  </div>

  <div id="commentswrap">
      <div id="comments"></div>
  </div>
  
    <script src="https://apis.google.com/js/plusone.js"></script>
    <script>
        $(document).ready(function () {
            gapi.comments.render('comments', {
                href: window.location,
                width: '600',
                first_party_property: 'BLOGGER',
                view_type: 'FILTERED_POSTMOD'
            });
    });
    </script>



</article>


    <div id="ending_message">
      <p>&copy; Charles Butler. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Charles Butler on <a href="https://github.com/chuckbutler/pelican-svbremix" target="_blank">github</a>. Member of the <a href="http://internetdefenseleague.org">Internet Defense League</a>.</p>
    </div>
  </main>
<script type="text/javascript">
  window._idl = {};
  _idl.variant = "banner";
  (function() {
    var idl = document.createElement('script');
    idl.type = 'text/javascript';
    idl.async = true;
    idl.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'members.internetdefenseleague.org/include/?url=' + (_idl.url || '') + '&campaign=' + (_idl.campaign || '') + '&variant=' + (_idl.variant || 'banner');
    document.getElementsByTagName('body')[0].appendChild(idl);
  })();
</script>
</body>
</html>