<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="http://blog.dasroot.net/theme/css/semantic.min.css">
  <link rel="stylesheet" type="text/css" href="http://blog.dasroot.net/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="http://blog.dasroot.net/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Charles Butler">
  <meta name="description" content="Posts and writings by Charles Butler">

  <link href="http://blog.dasroot.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Chuck@Home Atom" />
<meta name="keywords" content="juju, experience">

  <title>
    Chuck@Home
&ndash; Juju expose my-experience  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29116636-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://blog.dasroot.net">
        <img src="http://www.gravatar.com/avatar/78270a8df5051560ab56ad16bc4724a3.png?s=200" alt="Chuck@home" class="ui medium circular image">
      </a>
      <h2><a href="http://blog.dasroot.net">Chuck@Home</a></h2>
      <p>juju deploy happiness</p>
      <ul>
        <li><a href="http://charlesbutler.me/" target="_blank">About Chuck</a></li>
        <li><a href="http://blog.juju.solutions/" target="_blank">My GPG Key</a></li>
        <li><a href="http://blog.dasroot.net/archives" target="_blank">Archives</a></li>
        <li><a href="http://github.com/chuckbutler" target="_blank">Github</a></li>
        <li><a href="http://twitter.com/lazypower" target="_blank">Twitter</a></li>
        <li><a href="https://plus.google.com/+CharlesButlertheNinja" target="_blank">Google+</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="http://blog.dasroot.net">Index</a> &brvbar; <a href="http://blog.dasroot.net/archives.html">Archives</a>
      &brvbar; <a href="http://blog.dasroot.net/feeds/all.atom.xml">Atom</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h3><a href="http://blog.dasroot.net/juju-expose-my-experience.html">Juju expose my-experience</a></h3>
  </div>
  <div class="article_text">
    <hr />
<p>I'm right around the one month mark with my juju lab and I feel like I've progressed a long way in poking around in the space. I went from having watched and briefly interfaced with Juju to deploying clusters of apps to learn how they interface with one another.</p>
<p>Along the path I've been maintaining a self dialogue that I haven't been able to finish until now. My initial step into the Juju waters was configuration of the PaaS logging service Papertrail. This subordinate charm was more my depth charge to test the waters of the charm submission process. It was simple enough to fleshed out in a few hours having only written one very basic charm before, and came with a pre-existing charm request. </p>
<p>After I reached the first submission of the Papertrail charm, I immediately set out to work on the Errbit charm using Marco Ceppi's bash driven Discourse charm as a guide. What I yielded was <a href="https://github.com/chuckbutler/errbit-charm/commit/c11c50785c4042933a39857f830100310340fd15">a functioning</a> installation routine that utilized Marco's code as a base. It was fun, and survived a hdd swap, but I wanted to flex an area of my brain that I knew more intricately than Bash.</p>
<h3>Breaking the OPC habit</h3>
<p>The core belief of chef is that you should write your own cookbooks for your organizational needs and deploy from your in house 'special blend' of configuration magic. In my day job, I have made a few low level dependency cookbooks that give me a 'base' system. Configured to provide clean slate deployment from the development staff, preconfigured server templates for more complex application deployments - typically Rails or PHP stacks, and Capistrano powered release deployment and lifecycle management.</p>
<p>In my capistrano deploy configurations I was making excessive use of plugins, and gems. Most of which I knew what they were doing, however I always relied on Foreman to manage my process voodoo for environment flags, and pid management. By using these tools I cut myself out of an opportunity to template and reduce deployment time. Foreman generates "OK" application upstart scripts, however I was continually running into corner case issues that wouldn't have happened had I written an upstart script myself, and deployed as a template that gets updated on every release-upgrade This is a prime example of where blindly consuming O.P.C. (Other Peoples Code) will stunt your effective learning. With the sheer volume of applications I was handling the tradeoff was moving fast in the name of progress. When something got in my way I turned instead of studying.  </p>
<p>With that in mind, I digress back to the theory on using chef, cookbooks, and juju's hooks ecosystem.  I can see chef as a boon in this, but only if there are a baseline set of community audited cookbooks. I feel that the ubuntu community has a high quality gating process through peer review. It feels more fluid, and accepting than the chef peer review process.</p>
<h4>Orchestration is higher level than configuration management</h4>
<p>Using chef in juju at first is a bit of a mindwarp. Typical chef server provisioning involves a manifest, and handles deployment of the entire server stack vs a responsive hook system. This may be an indicator that chef has larger object oriented capacity than I was using previously. </p>
<p>One of the many tradeoffs I took with this approach is mixing and matching the hooks in bash and chef wrappers to prevent diving into the chef-solo agent when all I wanted to do was restart a service. I did however initially provision the start/stop hooks from within chef, and enjoyed watching my logs fill up with false positives from the NGINX upstart provider. Moving the logic into pure bash has removed this hurdle, but sacrifices a bit of the code maintainability. </p>
<h3>Prototyping with Python is fun and fast</h3>
<p>My lessons with Juju drove me to look at python. Its powering most of the core juju dev framework like <code>charm-tools</code> and <code>amulet</code>. I knew very little python coming into this experience so my first stop was the provisioning helper Fabric. I wrote a quick <a href="http://blog.dasroot.net/fabric-qemu-and-steamcmd/">deployment routine in Fabric</a>, and translated the routine to bash driven hooks for the <a href="https://github.com/chuckbutler/starbound-charm/">Starbound Charm</a></p>
<blockquote>
<p>I'm pretty excited about this, as it cuts a corner away from the chef depency. Moving into a Python first provisioner would cut down on the installation hook quite a bit. At writing deploying to an LXC container takes just under 4 minutes. The provisioning portion from time of first hook execution is hanging right around the 2 minute mark. This really makes me want to look into ansible as a provisioning framework.</p>
</blockquote>
<h3>Documentation</h3>
<p>The juju documentation covered about 95% of my questions. Barring peer relation information not being where I expected to find it; everything else was covered with example cases and API docs.</p>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 25 December 2013</p>
    <p>Category: <a href="http://blog.dasroot.net/category/misc.html">misc</a>
 &ndash; Tags:
      <a href="http://blog.dasroot.net/tag/juju.html">juju</a>,      <a href="http://blog.dasroot.net/tag/experience.html">experience</a>    </p>
  </div>

  <div id="commentswrap">
      <div id="comments"></div>
  </div>
  
    <script src="https://apis.google.com/js/plusone.js"></script>
    <script>
        $(document).ready(function () {
            gapi.comments.render('comments', {
                href: window.location,
                width: '600',
                first_party_property: 'BLOGGER',
                view_type: 'FILTERED_POSTMOD'
            });
    });
    </script>



</article>


    <div id="ending_message">
      <p>&copy; Charles Butler. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Charles Butler on <a href="https://github.com/chuckbutler/pelican-svbremix" target="_blank">github</a>. Member of the <a href="http://internetdefenseleague.org">Internet Defense League</a>.</p>
    </div>
  </main>
<script type="text/javascript">
  window._idl = {};
  _idl.variant = "banner";
  (function() {
    var idl = document.createElement('script');
    idl.type = 'text/javascript';
    idl.async = true;
    idl.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'members.internetdefenseleague.org/include/?url=' + (_idl.url || '') + '&campaign=' + (_idl.campaign || '') + '&variant=' + (_idl.variant || 'banner');
    document.getElementsByTagName('body')[0].appendChild(idl);
  })();
</script>
</body>
</html>